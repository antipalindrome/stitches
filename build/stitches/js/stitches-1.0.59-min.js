var requirejs,require,define;(function(global){var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.4",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,apsp=ap.splice,isBrowser=!!(typeof window!=="undefined"&&navigator&&document),isWebWorker=!isBrowser&&typeof importScripts!=="undefined",readyRegExp=isBrowser&&navigator.platform==="PLAYSTATION 3"?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera=typeof opera!=="undefined"&&opera.toString()==="[object Opera]",contexts={},cfg={},globalDefQueue=[],useInteractive=false;function isFunction(it){return ostring.call(it)==="[object Function]";}function isArray(it){return ostring.call(it)==="[object Array]";}function each(ary,func){if(ary){var i;for(i=0;i<ary.length;i+=1){if(ary[i]&&func(ary[i],i,ary)){break;}}}}function eachReverse(ary,func){if(ary){var i;for(i=ary.length-1;i>-1;i-=1){if(ary[i]&&func(ary[i],i,ary)){break;}}}}function hasProp(obj,prop){return hasOwn.call(obj,prop);}function getOwn(obj,prop){return hasProp(obj,prop)&&obj[prop];}function eachProp(obj,func){var prop;for(prop in obj){if(hasProp(obj,prop)){if(func(obj[prop],prop)){break;}}}}function mixin(target,source,force,deepStringMixin){if(source){eachProp(source,function(value,prop){if(force||!hasProp(target,prop)){if(deepStringMixin&&typeof value!=="string"){if(!target[prop]){target[prop]={};}mixin(target[prop],value,force,deepStringMixin);}else{target[prop]=value;}}});}return target;}function bind(obj,fn){return function(){return fn.apply(obj,arguments);};}function scripts(){return document.getElementsByTagName("script");}function getGlobal(value){if(!value){return value;}var g=global;each(value.split("."),function(part){g=g[part];});return g;}function makeError(id,msg,err,requireModules){var e=new Error(msg+"\nhttp://requirejs.org/docs/errors.html#"+id);e.requireType=id;e.requireModules=requireModules;if(err){e.originalError=err;}return e;}if(typeof define!=="undefined"){return;}if(typeof requirejs!=="undefined"){if(isFunction(requirejs)){return;}cfg=requirejs;requirejs=undefined;}if(typeof require!=="undefined"&&!isFunction(require)){cfg=require;require=undefined;}function newContext(contextName){var inCheckLoaded,Module,context,handlers,checkLoadedTimeoutId,config={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{},map:{},config:{}},registry={},undefEvents={},defQueue=[],defined={},urlFetched={},requireCounter=1,unnormalizedCounter=1;function trimDots(ary){var i,part;for(i=0;ary[i];i+=1){part=ary[i];if(part==="."){ary.splice(i,1);i-=1;}else{if(part===".."){if(i===1&&(ary[2]===".."||ary[0]==="..")){break;}else{if(i>0){ary.splice(i-1,2);i-=2;}}}}}}function normalize(name,baseName,applyMap){var pkgName,pkgConfig,mapValue,nameParts,i,j,nameSegment,foundMap,foundI,foundStarMap,starI,baseParts=baseName&&baseName.split("/"),normalizedBaseParts=baseParts,map=config.map,starMap=map&&map["*"];if(name&&name.charAt(0)==="."){if(baseName){if(getOwn(config.pkgs,baseName)){normalizedBaseParts=baseParts=[baseName];}else{normalizedBaseParts=baseParts.slice(0,baseParts.length-1);}name=normalizedBaseParts.concat(name.split("/"));trimDots(name);pkgConfig=getOwn(config.pkgs,(pkgName=name[0]));name=name.join("/");if(pkgConfig&&name===pkgName+"/"+pkgConfig.main){name=pkgName;}}else{if(name.indexOf("./")===0){name=name.substring(2);}}}if(applyMap&&(baseParts||starMap)&&map){nameParts=name.split("/");for(i=nameParts.length;i>0;i-=1){nameSegment=nameParts.slice(0,i).join("/");if(baseParts){for(j=baseParts.length;j>0;j-=1){mapValue=getOwn(map,baseParts.slice(0,j).join("/"));if(mapValue){mapValue=getOwn(mapValue,nameSegment);if(mapValue){foundMap=mapValue;foundI=i;break;}}}}if(foundMap){break;}if(!foundStarMap&&starMap&&getOwn(starMap,nameSegment)){foundStarMap=getOwn(starMap,nameSegment);starI=i;}}if(!foundMap&&foundStarMap){foundMap=foundStarMap;foundI=starI;}if(foundMap){nameParts.splice(0,foundI,foundMap);name=nameParts.join("/");}}return name;}function removeScript(name){if(isBrowser){each(scripts(),function(scriptNode){if(scriptNode.getAttribute("data-requiremodule")===name&&scriptNode.getAttribute("data-requirecontext")===context.contextName){scriptNode.parentNode.removeChild(scriptNode);return true;}});}}function hasPathFallback(id){var pathConfig=getOwn(config.paths,id);if(pathConfig&&isArray(pathConfig)&&pathConfig.length>1){removeScript(id);pathConfig.shift();context.require.undef(id);context.require([id]);return true;}}function splitPrefix(name){var prefix,index=name?name.indexOf("!"):-1;if(index>-1){prefix=name.substring(0,index);name=name.substring(index+1,name.length);}return[prefix,name];}function makeModuleMap(name,parentModuleMap,isNormalized,applyMap){var url,pluginModule,suffix,nameParts,prefix=null,parentName=parentModuleMap?parentModuleMap.name:null,originalName=name,isDefine=true,normalizedName="";if(!name){isDefine=false;name="_@r"+(requireCounter+=1);}nameParts=splitPrefix(name);prefix=nameParts[0];name=nameParts[1];if(prefix){prefix=normalize(prefix,parentName,applyMap);pluginModule=getOwn(defined,prefix);}if(name){if(prefix){if(pluginModule&&pluginModule.normalize){normalizedName=pluginModule.normalize(name,function(name){return normalize(name,parentName,applyMap);});}else{normalizedName=normalize(name,parentName,applyMap);}}else{normalizedName=normalize(name,parentName,applyMap);nameParts=splitPrefix(normalizedName);prefix=nameParts[0];normalizedName=nameParts[1];isNormalized=true;url=context.nameToUrl(normalizedName);}}suffix=prefix&&!pluginModule&&!isNormalized?"_unnormalized"+(unnormalizedCounter+=1):"";return{prefix:prefix,name:normalizedName,parentMap:parentModuleMap,unnormalized:!!suffix,url:url,originalName:originalName,isDefine:isDefine,id:(prefix?prefix+"!"+normalizedName:normalizedName)+suffix};}function getModule(depMap){var id=depMap.id,mod=getOwn(registry,id);if(!mod){mod=registry[id]=new context.Module(depMap);}return mod;}function on(depMap,name,fn){var id=depMap.id,mod=getOwn(registry,id);if(hasProp(defined,id)&&(!mod||mod.defineEmitComplete)){if(name==="defined"){fn(defined[id]);}}else{getModule(depMap).on(name,fn);}}function onError(err,errback){var ids=err.requireModules,notified=false;if(errback){errback(err);}else{each(ids,function(id){var mod=getOwn(registry,id);if(mod){mod.error=err;if(mod.events.error){notified=true;mod.emit("error",err);}}});if(!notified){req.onError(err);}}}function takeGlobalQueue(){if(globalDefQueue.length){apsp.apply(defQueue,[defQueue.length-1,0].concat(globalDefQueue));globalDefQueue=[];}}handlers={require:function(mod){if(mod.require){return mod.require;}else{return(mod.require=context.makeRequire(mod.map));}},exports:function(mod){mod.usingExports=true;if(mod.map.isDefine){if(mod.exports){return mod.exports;}else{return(mod.exports=defined[mod.map.id]={});}}},module:function(mod){if(mod.module){return mod.module;}else{return(mod.module={id:mod.map.id,uri:mod.map.url,config:function(){return(config.config&&getOwn(config.config,mod.map.id))||{};},exports:defined[mod.map.id]});}}};function cleanRegistry(id){delete registry[id];}function breakCycle(mod,traced,processed){var id=mod.map.id;if(mod.error){mod.emit("error",mod.error);}else{traced[id]=true;each(mod.depMaps,function(depMap,i){var depId=depMap.id,dep=getOwn(registry,depId);if(dep&&!mod.depMatched[i]&&!processed[depId]){if(getOwn(traced,depId)){mod.defineDep(i,defined[depId]);mod.check();}else{breakCycle(dep,traced,processed);}}});processed[id]=true;}}function checkLoaded(){var map,modId,err,usingPathFallback,waitInterval=config.waitSeconds*1000,expired=waitInterval&&(context.startTime+waitInterval)<new Date().getTime(),noLoads=[],reqCalls=[],stillLoading=false,needCycleCheck=true;if(inCheckLoaded){return;}inCheckLoaded=true;eachProp(registry,function(mod){map=mod.map;modId=map.id;if(!mod.enabled){return;}if(!map.isDefine){reqCalls.push(mod);}if(!mod.error){if(!mod.inited&&expired){if(hasPathFallback(modId)){usingPathFallback=true;stillLoading=true;}else{noLoads.push(modId);removeScript(modId);}}else{if(!mod.inited&&mod.fetched&&map.isDefine){stillLoading=true;if(!map.prefix){return(needCycleCheck=false);}}}}});if(expired&&noLoads.length){err=makeError("timeout","Load timeout for modules: "+noLoads,null,noLoads);err.contextName=context.contextName;return onError(err);}if(needCycleCheck){each(reqCalls,function(mod){breakCycle(mod,{},{});});}if((!expired||usingPathFallback)&&stillLoading){if((isBrowser||isWebWorker)&&!checkLoadedTimeoutId){checkLoadedTimeoutId=setTimeout(function(){checkLoadedTimeoutId=0;checkLoaded();},50);}}inCheckLoaded=false;}Module=function(map){this.events=getOwn(undefEvents,map.id)||{};this.map=map;this.shim=getOwn(config.shim,map.id);this.depExports=[];this.depMaps=[];this.depMatched=[];this.pluginMaps={};this.depCount=0;};Module.prototype={init:function(depMaps,factory,errback,options){options=options||{};if(this.inited){return;}this.factory=factory;if(errback){this.on("error",errback);}else{if(this.events.error){errback=bind(this,function(err){this.emit("error",err);});}}this.depMaps=depMaps&&depMaps.slice(0);this.errback=errback;this.inited=true;this.ignore=options.ignore;if(options.enabled||this.enabled){this.enable();}else{this.check();}},defineDep:function(i,depExports){if(!this.depMatched[i]){this.depMatched[i]=true;this.depCount-=1;this.depExports[i]=depExports;}},fetch:function(){if(this.fetched){return;}this.fetched=true;context.startTime=(new Date()).getTime();var map=this.map;if(this.shim){context.makeRequire(this.map,{enableBuildCallback:true})(this.shim.deps||[],bind(this,function(){return map.prefix?this.callPlugin():this.load();}));}else{return map.prefix?this.callPlugin():this.load();}},load:function(){var url=this.map.url;if(!urlFetched[url]){urlFetched[url]=true;context.load(this.map.id,url);}},check:function(){if(!this.enabled||this.enabling){return;}var err,cjsModule,id=this.map.id,depExports=this.depExports,exports=this.exports,factory=this.factory;if(!this.inited){this.fetch();}else{if(this.error){this.emit("error",this.error);}else{if(!this.defining){this.defining=true;if(this.depCount<1&&!this.defined){if(isFunction(factory)){if(this.events.error){try{exports=context.execCb(id,factory,depExports,exports);}catch(e){err=e;}}else{exports=context.execCb(id,factory,depExports,exports);}if(this.map.isDefine){cjsModule=this.module;if(cjsModule&&cjsModule.exports!==undefined&&cjsModule.exports!==this.exports){exports=cjsModule.exports;}else{if(exports===undefined&&this.usingExports){exports=this.exports;}}}if(err){err.requireMap=this.map;err.requireModules=[this.map.id];err.requireType="define";return onError((this.error=err));}}else{exports=factory;}this.exports=exports;if(this.map.isDefine&&!this.ignore){defined[id]=exports;if(req.onResourceLoad){req.onResourceLoad(context,this.map,this.depMaps);}}delete registry[id];this.defined=true;}this.defining=false;if(this.defined&&!this.defineEmitted){this.defineEmitted=true;this.emit("defined",this.exports);this.defineEmitComplete=true;}}}}},callPlugin:function(){var map=this.map,id=map.id,pluginMap=makeModuleMap(map.prefix);this.depMaps.push(pluginMap);on(pluginMap,"defined",bind(this,function(plugin){var load,normalizedMap,normalizedMod,name=this.map.name,parentName=this.map.parentMap?this.map.parentMap.name:null,localRequire=context.makeRequire(map.parentMap,{enableBuildCallback:true});if(this.map.unnormalized){if(plugin.normalize){name=plugin.normalize(name,function(name){return normalize(name,parentName,true);})||"";}normalizedMap=makeModuleMap(map.prefix+"!"+name,this.map.parentMap);on(normalizedMap,"defined",bind(this,function(value){this.init([],function(){return value;},null,{enabled:true,ignore:true});}));normalizedMod=getOwn(registry,normalizedMap.id);if(normalizedMod){this.depMaps.push(normalizedMap);if(this.events.error){normalizedMod.on("error",bind(this,function(err){this.emit("error",err);}));}normalizedMod.enable();}return;}load=bind(this,function(value){this.init([],function(){return value;},null,{enabled:true});});load.error=bind(this,function(err){this.inited=true;this.error=err;err.requireModules=[id];eachProp(registry,function(mod){if(mod.map.id.indexOf(id+"_unnormalized")===0){cleanRegistry(mod.map.id);}});onError(err);});load.fromText=bind(this,function(text,textAlt){var moduleName=map.name,moduleMap=makeModuleMap(moduleName),hasInteractive=useInteractive;if(textAlt){text=textAlt;}if(hasInteractive){useInteractive=false;}getModule(moduleMap);if(hasProp(config.config,id)){config.config[moduleName]=config.config[id];}try{req.exec(text);}catch(e){return onError(makeError("fromtexteval","fromText eval for "+id+" failed: "+e,e,[id]));}if(hasInteractive){useInteractive=true;}this.depMaps.push(moduleMap);context.completeLoad(moduleName);localRequire([moduleName],load);});plugin.load(map.name,localRequire,load,config);}));context.enable(pluginMap,this);this.pluginMaps[pluginMap.id]=pluginMap;},enable:function(){this.enabled=true;this.enabling=true;each(this.depMaps,bind(this,function(depMap,i){var id,mod,handler;if(typeof depMap==="string"){depMap=makeModuleMap(depMap,(this.map.isDefine?this.map:this.map.parentMap),false,!this.skipMap);this.depMaps[i]=depMap;handler=getOwn(handlers,depMap.id);if(handler){this.depExports[i]=handler(this);return;}this.depCount+=1;on(depMap,"defined",bind(this,function(depExports){this.defineDep(i,depExports);this.check();}));if(this.errback){on(depMap,"error",this.errback);}}id=depMap.id;mod=registry[id];if(!hasProp(handlers,id)&&mod&&!mod.enabled){context.enable(depMap,this);}}));eachProp(this.pluginMaps,bind(this,function(pluginMap){var mod=getOwn(registry,pluginMap.id);if(mod&&!mod.enabled){context.enable(pluginMap,this);}}));this.enabling=false;this.check();},on:function(name,cb){var cbs=this.events[name];if(!cbs){cbs=this.events[name]=[];}cbs.push(cb);},emit:function(name,evt){each(this.events[name],function(cb){cb(evt);});if(name==="error"){delete this.events[name];}}};function callGetModule(args){if(!hasProp(defined,args[0])){getModule(makeModuleMap(args[0],null,true)).init(args[1],args[2]);}}function removeListener(node,func,name,ieName){if(node.detachEvent&&!isOpera){if(ieName){node.detachEvent(ieName,func);}}else{node.removeEventListener(name,func,false);}}function getScriptData(evt){var node=evt.currentTarget||evt.srcElement;removeListener(node,context.onScriptLoad,"load","onreadystatechange");removeListener(node,context.onScriptError,"error");return{node:node,id:node&&node.getAttribute("data-requiremodule")};}function intakeDefines(){var args;takeGlobalQueue();while(defQueue.length){args=defQueue.shift();if(args[0]===null){return onError(makeError("mismatch","Mismatched anonymous define() module: "+args[args.length-1]));}else{callGetModule(args);}}}context={config:config,contextName:contextName,registry:registry,defined:defined,urlFetched:urlFetched,defQueue:defQueue,Module:Module,makeModuleMap:makeModuleMap,nextTick:req.nextTick,configure:function(cfg){if(cfg.baseUrl){if(cfg.baseUrl.charAt(cfg.baseUrl.length-1)!=="/"){cfg.baseUrl+="/";}}var pkgs=config.pkgs,shim=config.shim,objs={paths:true,config:true,map:true};eachProp(cfg,function(value,prop){if(objs[prop]){if(prop==="map"){mixin(config[prop],value,true,true);}else{mixin(config[prop],value,true);}}else{config[prop]=value;}});if(cfg.shim){eachProp(cfg.shim,function(value,id){if(isArray(value)){value={deps:value};}if((value.exports||value.init)&&!value.exportsFn){value.exportsFn=context.makeShimExports(value);}shim[id]=value;});config.shim=shim;}if(cfg.packages){each(cfg.packages,function(pkgObj){var location;pkgObj=typeof pkgObj==="string"?{name:pkgObj}:pkgObj;location=pkgObj.location;pkgs[pkgObj.name]={name:pkgObj.name,location:location||pkgObj.name,main:(pkgObj.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")};});config.pkgs=pkgs;}eachProp(registry,function(mod,id){if(!mod.inited&&!mod.map.unnormalized){mod.map=makeModuleMap(id);}});if(cfg.deps||cfg.callback){context.require(cfg.deps||[],cfg.callback);}},makeShimExports:function(value){function fn(){var ret;if(value.init){ret=value.init.apply(global,arguments);}return ret||(value.exports&&getGlobal(value.exports));}return fn;},makeRequire:function(relMap,options){options=options||{};function localRequire(deps,callback,errback){var id,map,requireMod;if(options.enableBuildCallback&&callback&&isFunction(callback)){callback.__requireJsBuild=true;}if(typeof deps==="string"){if(isFunction(callback)){return onError(makeError("requireargs","Invalid require call"),errback);}if(relMap&&hasProp(handlers,deps)){return handlers[deps](registry[relMap.id]);}if(req.get){return req.get(context,deps,relMap);}map=makeModuleMap(deps,relMap,false,true);id=map.id;if(!hasProp(defined,id)){return onError(makeError("notloaded",'Module name "'+id+'" has not been loaded yet for context: '+contextName+(relMap?"":". Use require([])")));}return defined[id];}intakeDefines();context.nextTick(function(){intakeDefines();requireMod=getModule(makeModuleMap(null,relMap));requireMod.skipMap=options.skipMap;requireMod.init(deps,callback,errback,{enabled:true});checkLoaded();});return localRequire;}mixin(localRequire,{isBrowser:isBrowser,toUrl:function(moduleNamePlusExt){var ext,url,index=moduleNamePlusExt.lastIndexOf("."),segment=moduleNamePlusExt.split("/")[0],isRelative=segment==="."||segment==="..";if(index!==-1&&(!isRelative||index>1)){ext=moduleNamePlusExt.substring(index,moduleNamePlusExt.length);moduleNamePlusExt=moduleNamePlusExt.substring(0,index);}url=context.nameToUrl(normalize(moduleNamePlusExt,relMap&&relMap.id,true),ext||".fake");return ext?url:url.substring(0,url.length-5);},defined:function(id){return hasProp(defined,makeModuleMap(id,relMap,false,true).id);},specified:function(id){id=makeModuleMap(id,relMap,false,true).id;return hasProp(defined,id)||hasProp(registry,id);}});if(!relMap){localRequire.undef=function(id){takeGlobalQueue();var map=makeModuleMap(id,relMap,true),mod=getOwn(registry,id);delete defined[id];delete urlFetched[map.url];delete undefEvents[id];if(mod){if(mod.events.defined){undefEvents[id]=mod.events;}cleanRegistry(id);}};}return localRequire;},enable:function(depMap){var mod=getOwn(registry,depMap.id);if(mod){getModule(depMap).enable();}},completeLoad:function(moduleName){var found,args,mod,shim=getOwn(config.shim,moduleName)||{},shExports=shim.exports;takeGlobalQueue();while(defQueue.length){args=defQueue.shift();if(args[0]===null){args[0]=moduleName;if(found){break;}found=true;}else{if(args[0]===moduleName){found=true;}}callGetModule(args);}mod=getOwn(registry,moduleName);if(!found&&!hasProp(defined,moduleName)&&mod&&!mod.inited){if(config.enforceDefine&&(!shExports||!getGlobal(shExports))){if(hasPathFallback(moduleName)){return;}else{return onError(makeError("nodefine","No define call for "+moduleName,null,[moduleName]));}}else{callGetModule([moduleName,(shim.deps||[]),shim.exportsFn]);}}checkLoaded();},nameToUrl:function(moduleName,ext){var paths,pkgs,pkg,pkgPath,syms,i,parentModule,url,parentPath;if(req.jsExtRegExp.test(moduleName)){url=moduleName+(ext||"");}else{paths=config.paths;pkgs=config.pkgs;syms=moduleName.split("/");for(i=syms.length;i>0;i-=1){parentModule=syms.slice(0,i).join("/");pkg=getOwn(pkgs,parentModule);parentPath=getOwn(paths,parentModule);if(parentPath){if(isArray(parentPath)){parentPath=parentPath[0];}syms.splice(0,i,parentPath);break;}else{if(pkg){if(moduleName===pkg.name){pkgPath=pkg.location+"/"+pkg.main;}else{pkgPath=pkg.location;}syms.splice(0,i,pkgPath);break;}}}url=syms.join("/");url+=(ext||(/\?/.test(url)?"":".js"));url=(url.charAt(0)==="/"||url.match(/^[\w\+\.\-]+:/)?"":config.baseUrl)+url;}return config.urlArgs?url+((url.indexOf("?")===-1?"?":"&")+config.urlArgs):url;},load:function(id,url){req.load(context,id,url);},execCb:function(name,callback,args,exports){return callback.apply(exports,args);},onScriptLoad:function(evt){if(evt.type==="load"||(readyRegExp.test((evt.currentTarget||evt.srcElement).readyState))){interactiveScript=null;var data=getScriptData(evt);context.completeLoad(data.id);}},onScriptError:function(evt){var data=getScriptData(evt);if(!hasPathFallback(data.id)){return onError(makeError("scripterror","Script error",evt,[data.id]));}}};context.require=context.makeRequire();return context;}req=requirejs=function(deps,callback,errback,optional){var context,config,contextName=defContextName;if(!isArray(deps)&&typeof deps!=="string"){config=deps;if(isArray(callback)){deps=callback;callback=errback;errback=optional;}else{deps=[];}}if(config&&config.context){contextName=config.context;}context=getOwn(contexts,contextName);if(!context){context=contexts[contextName]=req.s.newContext(contextName);}if(config){context.configure(config);}return context.require(deps,callback,errback);};req.config=function(config){return req(config);};req.nextTick=typeof setTimeout!=="undefined"?function(fn){setTimeout(fn,4);}:function(fn){fn();};if(!require){require=req;}req.version=version;req.jsExtRegExp=/^\/|:|\?|\.js$/;req.isBrowser=isBrowser;s=req.s={contexts:contexts,newContext:newContext};req({});each(["toUrl","undef","defined","specified"],function(prop){req[prop]=function(){var ctx=contexts[defContextName];return ctx.require[prop].apply(ctx,arguments);};});if(isBrowser){head=s.head=document.getElementsByTagName("head")[0];baseElement=document.getElementsByTagName("base")[0];if(baseElement){head=s.head=baseElement.parentNode;}}req.onError=function(err){throw err;};req.load=function(context,moduleName,url){var config=(context&&context.config)||{},node;if(isBrowser){node=config.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");node.type=config.scriptType||"text/javascript";node.charset="utf-8";node.async=true;node.setAttribute("data-requirecontext",context.contextName);node.setAttribute("data-requiremodule",moduleName);if(node.attachEvent&&!(node.attachEvent.toString&&node.attachEvent.toString().indexOf("[native code")<0)&&!isOpera){useInteractive=true;node.attachEvent("onreadystatechange",context.onScriptLoad);}else{node.addEventListener("load",context.onScriptLoad,false);node.addEventListener("error",context.onScriptError,false);}node.src=url;currentlyAddingScript=node;if(baseElement){head.insertBefore(node,baseElement);}else{head.appendChild(node);}currentlyAddingScript=null;return node;}else{if(isWebWorker){importScripts(url);context.completeLoad(moduleName);}}};function getInteractiveScript(){if(interactiveScript&&interactiveScript.readyState==="interactive"){return interactiveScript;}eachReverse(scripts(),function(script){if(script.readyState==="interactive"){return(interactiveScript=script);}});return interactiveScript;}if(isBrowser){eachReverse(scripts(),function(script){if(!head){head=script.parentNode;}dataMain=script.getAttribute("data-main");if(dataMain){if(!cfg.baseUrl){src=dataMain.split("/");mainScript=src.pop();subPath=src.length?src.join("/")+"/":"./";cfg.baseUrl=subPath;dataMain=mainScript;}dataMain=dataMain.replace(jsSuffixRegExp,"");cfg.deps=cfg.deps?cfg.deps.concat(dataMain):[dataMain];return true;}});}define=function(name,deps,callback){var node,context;if(typeof name!=="string"){callback=deps;deps=name;name=null;}if(!isArray(deps)){callback=deps;deps=[];}if(!deps.length&&isFunction(callback)){if(callback.length){callback.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(match,dep){deps.push(dep);});deps=(callback.length===1?["require"]:["require","exports","module"]).concat(deps);}}if(useInteractive){node=currentlyAddingScript||getInteractiveScript();if(node){if(!name){name=node.getAttribute("data-requiremodule");}context=contexts[node.getAttribute("data-requirecontext")];}}(context?context.defQueue:globalDefQueue).push([name,deps,callback]);};define.amd={jQuery:true};req.exec=function(text){return eval(text);};req(cfg);}(this));define("jquery",[],function(){return jQuery;});define("modernizr",[],function(){return Modernizr;});define("util/util",["jquery"],function($){return{proxy:function(context,methods){if(typeof methods==="string"){methods=methods.split(" ");}$.map(methods,function(method){context[method]=$.proxy(context[method],context);});},inherit:function(Child,Parent,methods){Child.prototype=new Parent();Child.prototype.constructor=Parent;$.each(methods,function(name,method){Child.prototype[name]=method;});Child.prototype._super=function(name,context,args){var method=Parent.prototype[name];return method.apply(context,args);};},debounce:function(func,threshold,execAsap){var timeout;return function(){var context=this;var args=arguments;var delayed=function(){if(!execAsap){func.apply(context,args);}timeout=null;};if(timeout){window.clearTimeout(timeout);}else{if(execAsap){func.apply(context,args);}}timeout=setTimeout(delayed,threshold||50);};},dataToObjectURL:function(dataURI){var dataParts=dataURI.split(",");var byteString;if(dataParts[0].indexOf("base64")>=0){byteString=atob(dataParts[1]);}else{byteString=decodeURIComponent(dataParts[1]);}var mimeString=dataParts[0].split(":")[1].split(";")[0];var bl=byteString.length;var ab=new ArrayBuffer(bl);var ia=new Uint8Array(ab);var i;for(i=0;i<bl;i++){ia[i]=byteString.charCodeAt(i);}var blob=this.createBlob(ab,mimeString);var url=this.createObjectURL(blob);return url;},createBlob:function(arrayBuffer,mimeString){var BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder;if(!BlobBuilder){throw new Error("BlobBuilder is unsupported.");}var bb=new BlobBuilder();bb.append(arrayBuffer);return bb.getBlob(mimeString);},createObjectURL:function(file){if(window.URL&&window.URL.createObjectURL){return window.URL.createObjectURL(file);}if(window.webkitURL&&window.webkitURL.createObjectURL){return window.webkitURL.createObjectURL(file);}throw new Error("createObjectURL is unsupported.");}};});define("layout/base",["jquery"],function($){var defaults={maxPass:2};var BaseLayout=function(options){this.settings=$.extend({},defaults,options);};BaseLayout.prototype={constructor:BaseLayout,getDimensions:function(){},placeSprites:function(){},intersection:function(sprite,obstacles){var x1,x2,y1,y2;var intersections=[];var intersection;$.map(obstacles,function(obstacle){x1=(obstacle.x<sprite.x+sprite.width);x2=(obstacle.x+obstacle.width>sprite.x);y1=(obstacle.y<sprite.y+sprite.height);y2=(obstacle.y+obstacle.height>sprite.y);if(x1&&x2&&y1&&y2){intersections.push(obstacle);}});if(intersections.length){intersection=intersections.pop();}return intersection;}};return BaseLayout;});define("layout/compact",["jquery","util/util","layout/base"],function($,util,BaseLayout){var defaults={maxPass:2};var CompactLayout=function(options){this.settings=$.extend({},defaults,options);};util.inherit(CompactLayout,BaseLayout,{getDimensions:function(sprites,defaults){var width=0;var height=0;var area=0;var mean=0;$.map(sprites,function(sprite){width=sprite.width>width?sprite.width:width;height=sprite.height>height?sprite.height:height;area+=sprite.area;});mean=Math.ceil(Math.sqrt(area));width=width>mean?width:mean;height=height>mean?height:mean;return{width:width||defaults.width,height:height||defaults.height};},placeSprite:function(sprite,placed,dimensions){var intersection;var pass=0;var x=0;var y=0;while(pass++<this.settings.maxPass){for(y=0;y<=dimensions.height-sprite.height;y++){for(x=0;x<=dimensions.width-sprite.width;x++){sprite.x=x;sprite.y=y;intersection=this.intersection(sprite,placed);if(!intersection){placed.push(sprite);sprite.show();return true;}x=intersection.x+intersection.width-1;}y=intersection.y+intersection.height-1;}dimensions.width+=sprite.width;dimensions.height+=sprite.height;}}});return CompactLayout;});define("layout/vertical",["jquery","util/util","layout/base"],function($,util,BaseLayout){var defaults={maxPass:2};var VerticalLayout=function(options){this.settings=$.extend({},defaults,options);};util.inherit(VerticalLayout,BaseLayout,{getDimensions:function(sprites,defaults){var width=0;var height=0;$.map(sprites,function(sprite){width=sprite.width>width?sprite.width:width;height+=sprite.height;});return{width:width||defaults.width,height:height||defaults.height};},placeSprite:function(sprite,placed,dimensions){var intersection;var pass=0;var x=0;var y=0;while(pass++<this.settings.maxPass){for(y=0;y<=dimensions.height-sprite.height;y++){sprite.x=x;sprite.y=y;intersection=this.intersection(sprite,placed);if(!intersection){placed.push(sprite);sprite.show();return true;}y=intersection.y+intersection.height-1;}dimensions.width+=sprite.width;dimensions.height+=sprite.height;}return false;}});return VerticalLayout;});define("layout/horizontal",["jquery","util/util","layout/base"],function($,util,BaseLayout){var defaults={maxPass:2};var HorizontalLayout=function(options){this.settings=$.extend({},defaults,options);};util.inherit(HorizontalLayout,BaseLayout,{getDimensions:function(sprites,defaults){var width=0;var height=0;$.map(sprites,function(sprite){height=sprite.height>height?sprite.height:height;width+=sprite.width;});return{width:width||defaults.width,height:height||defaults.height};},placeSprite:function(sprite,placed,dimensions){var intersection;var pass=0;var x=0;var y=0;while(pass++<this.settings.maxPass){for(x=0;x<=dimensions.width-sprite.width;x++){sprite.x=x;sprite.y=y;intersection=this.intersection(sprite,placed);if(!intersection){placed.push(sprite);sprite.show();return true;}x=intersection.x+intersection.width-1;}dimensions.width+=sprite.width;dimensions.height+=sprite.height;}return false;}});return HorizontalLayout;});define("util/stitches",["jquery","layout/compact","layout/vertical","layout/horizontal"],function($,CompactLayout,VerticalLayout,HorizontalLayout){var layouts={compact:CompactLayout,vertical:VerticalLayout,horizontal:HorizontalLayout};return{setLayout:function(type){var Constructor=layouts[type]||layouts.compact;this.layout=new Constructor();},getDimensions:function(sprites,defaults){return this.layout.getDimensions(sprites,defaults);},placeSprites:function(sprites,placed,dimensions,progress){var self=this;progress(0,"info");$.map(sprites,function(sprite){if(!sprite.placed){sprite.placed=self.layout.placeSprite(sprite,placed,dimensions);}progress(placed.length/sprites.length);});sprites=$.map(sprites,function(sprite){return sprite.placed?null:sprite;});},trim:function(sprites,dimensions){var w=0;var h=0;$.map(sprites,function(sprite){w=w>sprite.x+sprite.width?w:sprite.x+sprite.width;h=h>sprite.y+sprite.height?h:sprite.y+sprite.height;});dimensions.width=w||dimensions.width;dimensions.height=h||dimensions.height;},makeSpritesheet:function(sprites,dimensions){var canvas;var context;var spritesheet;canvas=document.createElement("canvas");canvas.width=dimensions.width;canvas.height=dimensions.height;try{context=canvas.getContext("2d");$.map(sprites,function(sprite){var x=sprite.x+sprite.padding;var y=sprite.y+sprite.padding;context.drawImage(sprite.image,x,y);});spritesheet=canvas.toDataURL("image/png");}catch(e){this.$element.trigger("error",[e]);}return spritesheet;},makeStylesheet:function(sprites,spritesheet,prefix,uri,style){var backgroundImage=uri?spritesheet:"download.png";var styles;var stylesheet;sprites=sprites.sort(function(a,b){return a.name<b.name?-1:1;});switch(style){case"less":styles=this.makeStylesLESS(sprites,prefix,backgroundImage);break;case"css":styles=this.makeStylesCSS(sprites,prefix,backgroundImage);break;default:break;}stylesheet="data:text/plain,"+encodeURIComponent(styles.join("\n"));return stylesheet;},makeStylesCSS:function(sprites,prefix,backgroundImage){var styles=["."+prefix+" {","    background: url("+backgroundImage+") no-repeat;","}\n"];$.map(sprites,function(sprite){styles=styles.concat(["."+prefix+"-"+sprite.name+" {","    width: "+sprite.image.width+"px;","    height: "+sprite.image.height+"px;","    background-position: -"+sprite.x+"px -"+sprite.y+"px;","}\n"]);});return styles;},makeStylesLESS:function(sprites,prefix,backgroundImage){var styles=["."+prefix+" (@x: 0, @y: 0, @width: 0, @height: 0) {","    background: url("+backgroundImage+") @x @y no-repeat;","    display: block;","    width: @width;","    height: @height;","}\n"];$.map(sprites,function(sprite){styles=styles.concat(["."+prefix+"-"+sprite.name+" {"," .sprite(-"+sprite.x+"px, -"+sprite.y+"px, "+sprite.image.width+"px, "+sprite.image.height+"px); ","}\n"]);});return styles;}};});(function(){var progIds=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],xmlRegExp=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,bodyRegExp=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,buildMap=[],templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g},template=function(str,data){var c=templateSettings;var tmpl="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+str.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(c.interpolate,function(match,code){return"',"+code.replace(/\\'/g,"'")+",'";}).replace(c.evaluate||null,function(match,code){return"');"+code.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"; __p.push('";}).replace(/\r/g,"").replace(/\n/g,"").replace(/\t/g,"")+"');}return __p.join('');";return tmpl;};define("tpl",[],function(){var tpl;var get,fs;if(typeof window!=="undefined"&&window.navigator&&window.document){get=function(url,callback){var xhr=tpl.createXhr();xhr.open("GET",url,true);xhr.onreadystatechange=function(evt){if(xhr.readyState===4){callback(xhr.responseText);}};xhr.send(null);};}else{if(typeof process!=="undefined"&&process.versions&&!!process.versions.node){fs=require.nodeRequire("fs");get=function(url,callback){callback(fs.readFileSync(url,"utf8"));};}}return tpl={version:"0.24.0",strip:function(content){if(content){content=content.replace(xmlRegExp,"");var matches=content.match(bodyRegExp);if(matches){content=matches[1];}}else{content="";}return content;},jsEscape:function(content){return content.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"").replace(/[\t]/g,"").replace(/[\r]/g,"");},createXhr:function(){var xhr,i,progId;if(typeof XMLHttpRequest!=="undefined"){return new XMLHttpRequest();}else{for(i=0;i<3;i++){progId=progIds[i];try{xhr=new ActiveXObject(progId);}catch(e){}if(xhr){progIds=[progId];break;}}}if(!xhr){throw new Error("require.getXhr(): XMLHttpRequest not available");}return xhr;},get:get,load:function(name,req,onLoad,config){var strip=false,url,index=name.indexOf("."),modName=name.substring(0,index),ext=name.substring(index+1,name.length);index=ext.indexOf("!");if(index!==-1){strip=ext.substring(index+1,ext.length);strip=strip==="strip";ext=ext.substring(0,index);}url="nameToUrl" in req?req.nameToUrl(modName,"."+ext):req.toUrl(modName+"."+ext);tpl.get(url,function(content){content=template(content);if(!config.isBuild){content=new Function("obj",content);}content=strip?tpl.strip(content):content;if(config.isBuild&&config.inlineText){buildMap[name]=content;}onLoad(content);});},write:function(pluginName,moduleName,write){if(moduleName in buildMap){var content=tpl.jsEscape(buildMap[moduleName]);write("define('"+pluginName+"!"+moduleName+"', function() {return function(obj) { "+content.replace(/(\\')/g,"'").replace(/(\\\\)/g,"\\")+"}});\n");}}};return function(){};});}());define("tpl!module/../../templates/stitches.html",function(){return function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="stitches">    <!-- .stitches-toolbar -->    <div class="stitches-toolbar btn-toolbar">        <div class="btn-group shrink">            <a href="http://draeton.github.com/stitches/" class="btn btn-small btn-link">                <strong>Stitches</strong>            </a>            <button data-action="open" class="btn btn-small btn-info files" title="Open">                <i class="icon-folder-open icon-white"></i> <span>Open</span><input class="file" type="file" multiple="">            </button>            <button data-action="settings" class="btn btn-small btn-info" title="Set layout, style prefix, padding, etc.">                <i class="icon-cog icon-white"></i> <span>Settings</span>            </button>            <button data-action="generate" class="btn btn-small btn-info disabled" title="Generate spritesheet and stylesheet">                <i class="icon-tasks icon-white"></i> <span>Generate</span>            </button>            <button data-action="clear" class="btn btn-small btn-info disabled" title="Clear sprites from the canvas">                <i class="icon-remove icon-white"></i> <span>Clear</span>            </button>        </div>        <div class="btn-group shrink">            <a href="#" data-action="spritesheet" class="btn btn-small btn-success disabled" title="Open the spritesheet in a new tab" target="_blank">                <i class="icon-download-alt icon-white"></i> <span>Spritesheet</span>            </a>            <a href="#" data-action="stylesheet" class="btn btn-small btn-success disabled" title="Open the stylesheet in a new tab" target="_blank">                <i class="icon-download-alt icon-white"></i> <span>Stylesheet</span>            </a>        </div>        <div class="btn-group shrink">            <button data-action="about" class="btn btn-small btn-info" title="About Stitches">                <i class="icon-info-sign icon-white"></i> <span>About</span>            </button>        </div>    </div>    <!-- /.stitches-toolbar -->    <!-- .stitches-progress -->    <div class="stitches-progress collapse">        <div class="progress progress-warning">            <div class="bar" style="width: 0%;"></div>        </div>    </div>    <!-- /.stitches-progress -->    <!-- .stitches-drop-box -->    <div class="stitches-drop-box">        <div class="stitches-overlay"></div>        <div class="stitches-wrap">            <!-- .stitches-canvas -->            <div class="stitches-canvas"></div>            <!-- /.stitches-canvas -->        </div>        <!-- .stitches-palettes -->        <div class="stitches-palettes">            <!-- .stitches-settings -->            <div class="stitches-palette stitches-settings fade">                <div class="stitches-palette-header">                    <button type="button" class="close" data-action="close" title="Close">&times;</button>                    <h4>Settings</h4>                </div>                <div class="stitches-palette-body">                    <form class="form-horizontal">                        <div class="control-group hide">                            <label class="control-label">Position</label>                            <div class="controls">                                <label class="checkbox">                                    <input name="position" type="checkbox" value="auto"/> Auto                                </label>                            </div>                        </div>                        <div class="control-group">                            <label class="control-label">Layout</label>                            <div class="controls">                                <label class="radio inline">                                    <input name="layout" type="radio" value="compact"/> Compact                                </label>                                <label class="radio inline">                                    <input name="layout" type="radio" value="vertical"/> Vertical                                </label>                                <label class="radio inline">                                    <input name="layout" type="radio" value="horizontal"/> Horizontal                                </label>                            </div>                        </div>                        <div class="control-group">                            <label class="control-label">CSS/LESS</label>                            <div class="controls">                                <label class="radio inline">                                    <input name="style" type="radio" value="css"/> CSS                                </label>                                <label class="radio inline">                                    <input name="style" type="radio" value="less"/> LESS                                </label>                            </div>                        </div>                        <div class="control-group">                            <label class="control-label">Style prefix</label>                            <div class="controls">                                <input name="prefix" type="text" placeholder="Style class prefix&hellip;">                            </div>                        </div>                        <div class="control-group">                            <label class="control-label">Padding</label>                            <div class="controls">                                <div class="input-append">                                    <input name="padding" type="number" min="0" required placeholder="Sprite padding&hellip;">                                    <span class="add-on">px</span>                                </div>                            </div>                        </div>                        <div class="control-group">                            <label class="control-label">Data URI</label>                            <div class="controls">                                <label class="checkbox">                                    <input name="uri" type="checkbox" value="true"/> Include encoded image in CSS                                </label>                            </div>                        </div>                    </form>                </div>                <div class="stitches-palette-footer">                    <div class="btn-toolbar">                        <div class="btn-group">                            <button class="btn btn-small btn-info" data-action="close" title="Save"><span>Save</span></button>                            <button class="btn btn-small btn-info" data-action="close" title="Close"><span>Close</span></button>                        </div>                    </div>                    <div class="clearfix"></div>                </div>            </div>            <!-- /.stitches-settings -->            <!-- .stitches-properties -->            <div class="stitches-palette stitches-properties fade">                <div class="stitches-palette-header">                    <button type="button" class="close" data-action="close" title="Close">&times;</button>                    <h4>Sprite Properties</h4>                </div>                <div class="stitches-palette-body">                    <form class="form-horizontal">                        <div class="control-group">                            <label class="control-label">Name</label>                            <div class="controls">                                <input name="name" type="text" required placeholder="Sprite name&hellip;">                            </div>                        </div>                        <div class="control-group">                            <label class="control-label">Coordinates (x, y)</label>                            <div class="controls">                                <div class="input-append">                                    <input name="x" required disabled placeholder="From left&hellip;" class="input-mini">                                    <span class="add-on">px</span>                                </div>                                <div class="input-append">                                    <input name="y" required disabled placeholder="From top&hellip;" class="input-mini">                                    <span class="add-on">px</span>                                </div>                            </div>                        </div>                    </form>                </div>                <div class="stitches-palette-footer">                    <div class="btn-toolbar">                        <div class="btn-group">                            <button class="btn btn-small btn-danger" data-action="remove" title="Delete"><span>Delete</span></button>                            <button class="btn btn-small btn-info" data-action="close" title="Save"><span>Save</span></button>                            <button class="btn btn-small btn-info" data-action="close" title="Close"><span>Close</span></button>                        </div>                    </div>                    <div class="clearfix"></div>                </div>            </div>            <!-- /.stitches-properties -->            <!-- .stitches-about -->            <div class="stitches-palette stitches-about fade in">                <div class="stitches-palette-header">                    <button type="button" class="close" data-action="close" title="Close">&times;</button>                    <h4>About Stitches</h4>                </div>                <div class="stitches-palette-body">                    <p><a href="http://draeton.github.com/stitches/">Stitches<a/> is an HTML5 <a href="http://en.wikipedia.org/wiki/Sprite_(computer_graphics)#Sprites_by_CSS">sprite sheet</a> generator.</p>                    <p>Drag &amp; drop image files onto the space below, or use the &ldquo;Open&rdquo; link to load images using the file browser. Then, click &ldquo;Generate&rdquo; to create a sprite sheet and stylesheet. <em>This demo uses a couple of HTML5 APIs, and it is only currently compatible with WebKit and Firefox browsers.</em></p>                    <p>Stitches is developed by <a href="http://draeton.github.com">Matthew Cobbs</a> in concert with the lovely open-source community at <a href="http://github.com">Github</a>. Thanks are owed to the developers at Twitter for <a href="http://twitter.github.com/bootstrap">Bootstrap</a>, and <a href="http://glyphicons.com/">Glyphicons</a> for some cool little icons.</p>                </div>                <div class="stitches-palette-footer">                    <div class="btn-toolbar">                        <div class="btn-group">                            <button class="btn btn-small btn-info" data-action="close" title="Close"><span>Close</span></button>                        </div>                    </div>                    <div class="clearfix"></div>                </div>            </div>            <!-- /.stitches-properties -->        </div>        <!-- /.stitches-palettes -->    </div>    <!-- /.stitches-drop-box --></div>');}return __p.join("");};});define("module/file-manager",["jquery","util/util"],function($,util){var defaults={progress:function(){}};var FileManager=function(element,options){this.$element=$(element);this.settings=$.extend({},defaults,options);this.progress=this.settings.progress;this.total=0;this.processed=0;this.init();};FileManager.prototype={constructor:FileManager,init:function(){},processFiles:function(files){var self=this;this.total=files.length;this.processed=0;$.map(files,function(file){if(/jpeg|png|gif/.test(file.type)){self.processFile(file);}});this.progress(0,"info");},processFile:function(file){var self=this;var reader;try{reader=new FileReader();reader.onloadend=function(e){var name=file.name;var src=e.target.result;self.$element.trigger("create-sprite",[name,src]);self.progress(++self.processed/self.total);};reader.readAsDataURL(file);}catch(e){this.$element.trigger("error",[e]);}}};return FileManager;});define("module/drop-box",["jquery","util/util"],function($,util){var defaults={};var DropBox=function(element,options){this.$element=$(element);this.$overlay=this.$element.find(".stitches-overlay");this.settings=$.extend({},defaults,options);this.init();};DropBox.classname=".stitches-drop-box";DropBox.prototype={constructor:DropBox,init:function(){this.proxy();this.bind();},proxy:function(){util.proxy(this,"dragStart dragStop drop");},bind:function(){var dropBox=this.$element.get(0);var overlay=this.$overlay.get(0);dropBox.addEventListener("dragenter",this.dragStart,false);overlay.addEventListener("dragleave",this.dragStop,false);overlay.addEventListener("dragexit",this.dragStop,false);overlay.addEventListener("dragover",this.noop,false);overlay.addEventListener("drop",this.drop,false);},noop:function(e){e.preventDefault();e.stopPropagation();},dragStart:function(e){this.$element.trigger("close-palettes");this.$element.trigger("show-overlay");},dragStop:function(e){if($.contains(this.$element,e.target)){this.$element.trigger("hide-overlay");}},drop:function(e){var files=(e.files||e.dataTransfer.files);e.stopPropagation();e.preventDefault();if(files.length){this.$element.trigger("process-files",[files]);}else{this.$element.trigger("hide-overlay");}}};return DropBox;});define("util/array",["jquery"],function($){return{remove:function(array,value){return $(array).filter(function(){return this!==value;});}};});define("tpl!module/../../templates/sprite.html",function(){return function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('<div class="stitches-sprite" style="top: ',y,"px; left: ",x,'px;">    <img src="',image.src,'"/></div>');}return __p.join("");};});define("module/sprite",["jquery","util/util","tpl!../../templates/sprite.html"],function($,util,spriteTemplate){var defaults={name:"",src:"",padding:0,callback:null};var Sprite=function(options){this.settings=$.extend({},defaults,options);this.$element=null;this.name=this.cleanName(this.settings.name);this.src=this.settings.src;this.padding=parseInt(this.settings.padding,10);this.callback=this.settings.callback;this.active=false;this.placed=false;this.init();};Sprite.classname=".stitches-sprite";Sprite.prototype={constructor:Sprite,init:function(){this.load();},load:function(){var self=this;this.image=new Image();this.image.onload=function(){self.x=0;self.y=0;self.width=self.image.width+self.padding*2;self.height=self.image.height+self.padding*2;self.area=self.width*self.height;self.render();self.proxy();self.bind();if(self.callback){self.callback(self);}};this.image.src=this.src;},render:function(){var html=spriteTemplate(this);this.$element=$(html);this.$element.data("sprite",this);},proxy:function(){util.proxy(this,"click");},bind:function(){this.$element.on("click",this.click);},reset:function(){this.x=0;this.y=0;this.placed=false;this.$element.removeClass("placed");},show:function(){this.$element.css({left:this.x+"px",top:this.y+"px",padding:this.padding+"px"}).addClass("placed");},click:function(e){this.active=!this.active;if(this.active){this.$element.trigger("clear-active",[this]);this.$element.trigger("open-properties",[this]);}else{this.$element.trigger("close-properties");}this.$element.toggleClass("active");},configure:function(properties){if(properties.padding){this.padding=parseInt(properties.padding,10);this.width=this.image.width+this.padding*2;this.height=this.image.height+this.padding*2;this.area=this.width*this.height;}},cleanName:function(name){name=name.replace(/\.\w+$/i,"");name=name.replace(/[\s.]+/gi,"-");name=name.replace(/[^a-z0-9\-]/gi,"_");return name;}};return Sprite;});define("module/canvas",["jquery","util/util","util/array","util/stitches","module/sprite"],function($,util,array,stitches,Sprite){var defaults={images:null,dimensions:{width:400,height:400},progress:function(){}};var Canvas=function(element,options){this.$element=$(element);this.settings=$.extend({},defaults,options);this.images=this.settings.images;this.dimensions=this.settings.dimensions;this.progress=this.settings.progress;this.sprites=[];this.spritesheet=null;this.stylesheet=null;this.init();};Canvas.classname=".stitches-canvas";Canvas.prototype={constructor:Canvas,init:function(){this.reset=util.debounce(this.reset,500);this.proxy();this.bind();this.setup();this.reset();},proxy:function(){util.proxy(this,"createSprite clearActive");},bind:function(){this.$element.on("create-sprite",this.createSprite);this.$element.on("clear-active",this.clearActive);},setup:function(){var self=this;$(this.images).each(function(){var $img=$(this);var name=$img.data("name");var src=$img.attr("src");self.$element.trigger("create-sprite",[name,src]);}).remove();},reset:function(){this.$element.trigger("show-overlay");this.measure(this.sprites);this.place(this.sprites);this.cut(this.sprites);this.$element.trigger("generate-sheets");this.$element.trigger("hide-overlay");},measure:function(sprites){this.dimensions=stitches.getDimensions(sprites,this.settings.dimensions);},place:function(sprites){var placed=[];$.map(sprites,function(sprite){sprite.reset();});sprites=sprites.sort(function(a,b){if(b.area===a.area){return b.name>a.name?1:-1;}else{return b.area-a.area;}});stitches.placeSprites(sprites,placed,this.dimensions,this.progress);},cut:function(sprites){stitches.trim(sprites,this.dimensions);this.$element.css({width:this.dimensions.width+"px",height:this.dimensions.height+"px"});},add:function(sprite){this.$element.trigger("show-overlay");this.sprites.push(sprite);sprite.$element.appendTo(this.$element);this.$element.trigger("update-toolbar");this.reset();},remove:function(sprite){this.$element.trigger("show-overlay");this.sprites=array.remove(this.sprites,sprite);sprite.$element.fadeOut("fast").remove();this.$element.trigger("update-toolbar");this.$element.trigger("close-properties");this.reset();},clear:function(){this.$element.trigger("show-overlay");this.sprites=[];this.$element.empty();this.$element.trigger("update-toolbar");this.$element.trigger("close-properties");this.$element.trigger("open-settings");this.reset();},clearActive:function(e,sprite){this.$element.find(".active").each(function(){var $active=$(this);var active=$active.data("sprite");if(sprite&&active!==sprite){$active.removeClass("active");active.active=false;}});},createSprite:function(e,name,src){var self=this;var sprite=new Sprite({name:name,src:src,padding:this.settings.padding,callback:function(sprite){self.add(sprite);}});}};return Canvas;});define("module/toolbar",["jquery"],function($){var defaults={name:"",actions:{}};var Toolbar=function(element,options){this.$element=$(element);this.settings=$.extend({},defaults,options);this.name=this.settings.name;this.actions=this.settings.actions;this.init();};Toolbar.classname=".stitches-toolbar";Toolbar.prototype={constructor:Toolbar,init:function(){this.bind();},bind:function(){var self=this;$.each(this.actions,function(action,events){$.each(events,function(event,callback){var selector="[data-action="+action+"]";var handler=self.getHandler(self,callback);if(action==="instance"){self.$element.on(event,self.getHandler(self,handler));}else{self.$element.on(event,selector,handler);}});});},getHandler:function(context,callback){return function(e){var $target=$(e.currentTarget);if($target.is(".disabled")){e.stopPropagation();e.preventDefault();}else{callback.apply(context,arguments);}};},toggleActions:function(actions,disable){var self=this;if(typeof actions==="string"){actions=actions.split(" ");}$.map(actions,function(action){var $tool=self.$element.find("[data-action="+action+"]");$tool.toggleClass("disabled",disable);});},enable:function(actions){this.toggleActions(actions,false);},disable:function(actions){this.toggleActions(actions,true);}};return Toolbar;});define("module/palette",["jquery","util/util","module/toolbar"],function($,util,Toolbar){var defaults={name:"",visible:false,actions:{},fields:{}};var Palette=function(element,options){this.$element=$(element);this.settings=$.extend({},defaults,options);this.name=this.settings.name;this.visible=this.settings.visible;this.actions=this.settings.actions;this.fields=this.settings.fields;this.source=null;this.init();};Palette.classname=".stitches-palette";util.inherit(Palette,Toolbar,{init:function(){this._super("init",this,arguments);this.$element.toggleClass("in",this.visible);},bind:function(){var self=this;this._super("bind",this,arguments);$.each(this.fields,function(field,events){$.each(events,function(event,callback){var selector="[name="+field+"]";var handler=self.getHandler(self,callback);self.$element.on(event,selector,handler);});});},open:function(){this.$element.addClass("in");this.visible=true;},close:function(){this.$element.removeClass("in");this.visible=false;},configure:function(properties){var self=this;this.source=properties.source;$.each(properties.inputs,function(name,value){var selector="input[name="+name+"]";var $input=self.$element.find(selector);var type=$input.attr("type");switch(type){case"radio":case"checkbox":$input=$input.removeAttr("checked").filter("[value="+value+"]");$input.attr("checked","checked");break;default:$input.val(value);break;}});}});return Palette;});define("module/stitches",["jquery","modernizr","util/util","util/stitches","tpl!../../templates/stitches.html","module/file-manager","module/drop-box","module/canvas","module/toolbar","module/palette"],function($,Modernizr,util,stitches,stitchesTemplate,FileManager,DropBox,Canvas,Toolbar,Palette){(function(){if(typeof FileReader==="undefined"||!Modernizr.draganddrop){require(["../lib/dropfile/dropfile"]);}if(!Modernizr.canvas){require(["../lib/flashcanvas/flashcanvas"]);}}());var defaults={layout:"compact",prefix:"sprite",padding:5,uri:false,style:"css"};var Stitches=function(element,options){this.$element=$(element);this.settings=$.extend({},defaults,options);this.init();};Stitches.prototype={constructor:Stitches,init:function(){this.render();this.proxy();this.bind();this.setFileManager();this.setDropBox();this.setToolbar();this.setLayout();this.setImages();this.setCanvas();this.setPalettes();},render:function(){var html=stitchesTemplate({});this.$element.append(html);this.$overlay=this.$element.find(".stitches-overlay");this.$dropBox=this.$element.find(".stitches-drop-box");this.$toolbar=this.$element.find(".stitches-toolbar");this.$canvas=this.$element.find(".stitches-canvas");this.$progress=this.$element.find(".stitches-progress .progress");this.$progressBar=this.$element.find(".stitches-progress .bar");this.$about=this.$element.find(".stitches-about");this.$settings=this.$element.find(".stitches-settings");this.$properties=this.$element.find(".stitches-properties");},proxy:function(){util.proxy(this,"showOverlay hideOverlay openAbout closeAbout openSettings closeSettings openProperties closeProperties closePalettes processFiles updateToolbar updateProgress generateSheets errorHandler");},bind:function(){this.$element.on("show-overlay",this.showOverlay);this.$element.on("hide-overlay",this.hideOverlay);this.$element.on("open-about",this.openAbout);this.$element.on("close-about",this.closeAbout);this.$element.on("open-settings",this.openSettings);this.$element.on("close-settings",this.closeSettings);this.$element.on("open-properties",this.openProperties);this.$element.on("close-properties",this.closeProperties);this.$element.on("close-palettes",this.closePalettes);this.$element.on("process-files",this.processFiles);this.$element.on("update-toolbar",this.updateToolbar);this.$element.on("generate-sheets",this.generateSheets);this.$element.on("error",this.errorHandler);},setFileManager:function(){this.fileManager=new FileManager(this.$canvas,{progress:this.updateProgress});},setDropBox:function(){this.dropBox=new DropBox(this.$dropBox);},setLayout:function(){stitches.setLayout(this.settings.layout);},setImages:function(){this.images=this.$element.find("> img").get();},setCanvas:function(){this.canvas=new Canvas(this.$canvas,{images:this.images,padding:this.settings.padding,progress:this.updateProgress});},setToolbar:function(){var self=this;this.toolbar=new Toolbar(this.$toolbar,{name:"toolbar",actions:{open:{change:function(e){var $input=self.$toolbar.find("input[type=file]");var $clone=$input.clone(true).val("");var files=e.target.files;self.$element.trigger("process-files",[files]);$input.replaceWith($clone);}},settings:{click:function(e){self.$element.trigger("open-settings");}},reset:{click:function(e){self.canvas.reset();}},generate:{click:function(e){self.$element.trigger("show-overlay");self.$element.trigger("generate-sheets");self.$element.trigger("hide-overlay");}},clear:{click:function(e){self.canvas.clear();}},spritesheet:{click:function(e){}},stylesheet:{click:function(e){}},about:{click:function(e){self.$element.trigger("open-about");}}}});},setPalettes:function(){var self=this;var about=new Palette(this.$about,{name:"about",visible:true,actions:{close:{click:function(e){this.close();}}}});var settings=new Palette(this.$settings,{name:"settings",visible:false,actions:{close:{click:function(e){self.$element.trigger("close-settings");}}},fields:{layout:{change:function(e){var $checked=this.$element.find("input[name=layout]:checked");var layout=$checked.val();this.source.layout=layout;stitches.setLayout(layout);self.canvas.reset();}},style:{change:function(e){var $checked=this.$element.find("input[name=style]:checked");var style=$checked.val();self.settings.style=style;self.canvas.reset();}},prefix:{"input blur":function(e){var prefix=$(e.currentTarget).val();this.source.prefix=prefix;}},padding:{"input blur":function(e){var padding=$(e.currentTarget).val();this.source.padding=padding;self.canvas.padding=padding;$.map(self.canvas.sprites,function(sprite){sprite.configure({padding:padding});});self.canvas.reset();}},uri:{change:function(e){var uri=$(e.currentTarget).is(":checked");this.source.uri=uri;}}}});var properties=new Palette(this.$properties,{name:"properties",visible:false,actions:{close:{click:function(e){self.$element.trigger("close-properties");}},remove:{click:function(e){var sprite=this.source;self.canvas.remove(sprite);}}},fields:{name:{"input blur":function(e){var sprite=this.source;var name=$(e.currentTarget).val();var clean=sprite.cleanName(name);this.source.name=clean;if(name!==clean){$(e.currentTarget).val(clean);}}}}});this.palettes={about:about,settings:settings,properties:properties};},showOverlay:function(e,type){this.$overlay.fadeTo("fast",0.4);},hideOverlay:function(e){this.$overlay.fadeOut("fast");},openAbout:function(e){this.closePalettes();this.palettes.about.open();},closeAbout:function(e){if(this.palettes.about.visible){this.palettes.about.close();}},openSettings:function(e){this.closePalettes();this.palettes.settings.configure({source:this.settings,inputs:{layout:this.settings.layout,style:this.settings.style,prefix:this.settings.prefix,padding:this.settings.padding,uri:this.settings.uri}});this.palettes.settings.open();},closeSettings:function(e){if(this.palettes.settings.visible){this.palettes.settings.close();}},openProperties:function(e,sprite){this.closePalettes();this.palettes.properties.configure({source:sprite,inputs:{name:sprite.name,x:sprite.x+sprite.padding,y:sprite.y+sprite.padding}});this.palettes.properties.open();},closeProperties:function(e){if(this.palettes.properties.visible){this.palettes.properties.close();this.canvas.$element.trigger("clear-active",[true]);}},closePalettes:function(e){this.closeAbout();this.closeSettings();this.closeProperties();},processFiles:function(e,files){this.fileManager.processFiles(files);},updateToolbar:function(e){var $toolbar=this.toolbar.$element;var toolbar=this.toolbar;var canvas=this.canvas;if(canvas.sprites.length){toolbar.enable("reset generate clear spritesheet stylesheet");$toolbar.find("[data-action=spritesheet]").attr("href",this.spritesheet);$toolbar.find("[data-action=stylesheet]").attr("href",this.stylesheet);}else{toolbar.disable("reset generate clear spritesheet stylesheet");$toolbar.find("[data-action=spritesheet]").attr("href","#");$toolbar.find("[data-action=stylesheet]").attr("href","#");}},updateProgress:function(progress,type){var percent=Math.ceil(progress*100);if(percent===100&&type!=="danger"&&type!=="warning"){type="success";}if(type){this.$progress.attr({"class":"progress progress-striped progress-"+type});}this.$progressBar.css({width:percent+"%"});},generateSheets:function(e){var sprites=this.canvas.sprites;var dimensions=this.canvas.dimensions;var prefix=this.settings.prefix;var uri=this.settings.uri;var style=this.settings.style;var spritesheet;var stylesheet;spritesheet=stitches.makeSpritesheet(sprites,dimensions);stylesheet=stitches.makeStylesheet(sprites,spritesheet,prefix,uri,style);try{spritesheet=util.dataToObjectURL(spritesheet);stylesheet=util.dataToObjectURL(stylesheet);}catch(ex){this.$element.trigger("error",[ex]);}this.spritesheet=spritesheet;this.stylesheet=stylesheet;this.$element.trigger("update-toolbar");this.updateProgress(1,"success");},errorHandler:function(e,err,type){this.updateProgress(1,type||"warning");}};return Stitches;});require({paths:{tpl:"../tpl",jquery:"wrap/jquery",modernizr:"wrap/modernizr"}},["jquery","module/stitches"],function($,Stitches){$(document).ready(function(){var selector=".stitches";$(selector).each(function(){var stitches=new Stitches(this);});});});define("stitches",function(){});